<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Water Sample Results - {{ $sample->laboratory_no }}</title>
  <style>
    body{ font-family: DejaVu Sans, sans-serif; font-size: 12px; }
    h1,h2{ margin: 0 0 6px; }
    .muted{ color:#555; }
    table{ width:100%; border-collapse:collapse; margin-top:10px; }
    th,td{ border:1px solid #ddd; padding:6px; vertical-align:top; }
    th{ background:#f4f4f4; text-align:left; }
    .section{ margin-top:18px; }
    .center { text-align:center; }
  </style>
</head>
<body>

  <!-- New top titles -->
  <div class="brand-logo" style="text-align:center; margin-bottom:8px">
    <img src="{{ public_path('images/Aqua-mission/Navigation Logo 2.png') }}" alt="Logo" style="height:80px;">
  </div>
  <h1 class="center">National Water Supply and Drainage Board</h1>
  <h2 class="center">Water Sample Test Results</h2>

  <div class="muted">Laboratory No: <strong>{{ $sample->laboratory_no }}</strong></div>
  <div class="muted">Received Date: {{ \Carbon\Carbon::parse($sample->date)->format('Y-m-d') }}</div>

  <div class="section">
    <h2>Consumer Details</h2>
    <table>
      <tr><th>Name</th><td>{{ $sample->consumer->full_name }}</td></tr>
      <tr><th>NIC</th><td>{{ $sample->consumer->nic }}</td></tr>
      <tr><th>Contact</th><td>{{ $sample->consumer->contact_number }}</td></tr>
      <tr><th>Email</th><td>{{ $sample->consumer->email }}</td></tr>
      <tr><th>Address</th><td>{{ $sample->consumer->address }}</td></tr>
    </table>
  </div>

  <div class="section">
    <h2>Summary</h2>
    <table>
      <tr><th>Subtotal</th><td>{{ number_format($sample->subtotal,2) }}</td></tr>
      <tr><th>VAT</th><td>{{ number_format($sample->vat,2) }}</td></tr>
      <tr><th>Total</th><td>{{ number_format($sample->total_payment_amount,2) }}</td></tr>
      <tr><th>Paid</th><td>{{ number_format($sample->paid_amount,2) }} ({{ $sample->payment_status }})</td></tr>
      <tr><th>Balance</th><td>{{ number_format($sample->balance,2) }}</td></tr>
      <tr><th>Sample Count</th><td>{{ $sample->sample_count }}</td></tr>
    </table>
  </div>

  @foreach($sample->sampleData as $idx => $item)
    <div class="section">
      <h2>Sample #{{ $idx+1 }} â€” Ref: {{ $item->reference_number }}</h2>
      <table>
        <tr><th>Source</th><td>{{ $item->source }}</td></tr>
        <tr><th>Location</th><td>{{ $item->sample_locations }}</td></tr>
        <tr><th>Quantity</th><td>{{ $item->quantity }}</td></tr>
        <tr><th>Temperature</th><td>{{ $item->temperature }}</td></tr>
        <tr><th>Collected</th><td>{{ $item->collected }}</td></tr>
        <tr><th>Weather</th><td>{{ $item->weather_condition }}</td></tr>
        <tr><th>Testing Status</th><td>{{ $item->testing_status }}</td></tr>
      </table>

      <!-- Parameters table (server-side; no Vue directives here) -->
      <table style="margin-top:10px">
        <thead>
          <tr>
            <th style="width:30%">PARAMETERS</th>
            <th style="width:15%">Results</th>
            <th style="width:20%">Methods</th>
            <th style="width:15%">SLS 614:2013</th>
            <th style="width:10%">Units</th>
            {{-- <th style="width:10%">Times</th> --}}
          </tr>
        </thead>
        <tbody>
          @forelse($item->tests as $t)
            @php
              $meta = $testDetails[$t->test] ?? [];
              $paramName = $meta['name'] ?? $t->test;
              $method    = $meta['standard'] ?? '-';
              $limit     = $meta['limit'] ?? '-';
              $unit      = $meta['unit'] ?? '-';
            @endphp
            <tr>
              <td>{{ $paramName }}</td>
              <td>{{ $t->result }}</td>
              <td>{{ $method }}</td>
              <td>{{ $limit }}</td>
              <td>{{ $unit }}</td>
              {{-- <td>{{ $t->times }}</td> --}}
            </tr>
          @empty
            <tr><td colspan="6">No tests recorded.</td></tr>
          @endforelse
        </tbody>
      </table>
    </div>
  @endforeach

  <div class="section" style="margin-top:20px">
    <small class="muted">
      Automated report generated by the Laboratory Information System. This PDF is an informational copy. 
    </small>
  </div>
</body>
</html>
